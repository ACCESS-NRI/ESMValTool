# recipe_ecs_scatter.yml
---
documentation:
  description: |
    Calculates equilibrium climate sensitivity (ECS) versus
    1) southern ITCZ index, similar to fig. 2 from Tian (2015)
    2) lower tropospheric mixing index (LTMI), similar to fig. 5 from
       Sherwood et al. (2014)
    3) tropical mid-tropospheric humidity asymmetry index, similar to fig. 4
       from Tian (2015)
    4) covariance of shortwave cloud reflection (Brient and Schneider, 2016)
    5) climatological Hadley cell extent (Lipat et al., 2017)

    ***************************************************************************
    Note: this recipe requires pre-calulation of the equilirium climate
          sensitivites (ECS) for all models. The ECS values are calculated
          with recipe_ecs.yml. The netcdf file containing the ECS values
          (path and filename) is specified by diag_script_info@ecs_file.
          Alternatively, the netcdf file containing the ECS values can be
          generated with the cdl-script
          $diag_scripts/emergent_constraints/ecs_cmip.cdl (recommended method):
          1) save script given at the end of this namelist as ecs_cmip.cdl
          2) run command: ncgen -o ecs_cmip.nc ecs_cmip.cdl
          3) copy ecs_cmip.nc to directory given by diag_script_info@ecs_file
             (e.g. $diag_scripts/emergent_constraints/ecs_cmip.nc)
    ***************************************************************************

  authors:
    - laue_ax

  maintainer:
    - laue_ax

  references:
    - brient16jclim
    - lipat17grl
    - sherwood14nat
    - tian15grl

  projects:
    - crescendo


preprocessors:
  pp500:
    extract_levels:
      levels: 50000
      scheme: linear

  pp_ltmi_0:
    extract_levels:
      levels: [85000, 70000, 60000, 50000, 40000]
      scheme: linear

  pp_ltmi_1:
    extract_levels:
      levels: [85000, 70000]
      scheme: linear


diagnostics:

  itczidx:
    description: southern ITCZ index
    themes:
      - EC
    realms:
      - atmos
    variables:
      pr:
        reference_dataset: TRMM-L3
        start_year: 1998
        end_year: 2013
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: TRMM-L3, project: obs4mips, level: v7, version: 7A, tier: 1}
          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r19i1p1f1}
          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
      prStderr:
        reference_dataset: TRMM-L3
        mip: Amon
        frequency: mon
        start_year: 1998
        end_year: 2013
        additional_datasets:
          - {dataset: TRMM-L3, project: obs4mips, level: v7, version: 7A, tier: 1}
    scripts:
      ecs_scatter:
        diag: itczidx
        calcmm: True
        ecs_file: $diag_scripts/emergent_constraints/ecs_cmip.nc
        legend_outside: False
        predef_minmax: True
        script: emergent_constraints/ecs_scatter.ncl

  humidx:
    description: tropical mid-tropospheric humidity asymmetry index
    themes:
      - EC
    realms:
      - atmos
    variables:
      hus:
        preprocessor: pp500
        reference_dataset: AIRS
        start_year: 2003
        end_year: 2010
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: AIRS, project: obs4mips, level: L3, version: RetStd-v5, tier: 1}
          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r19i1p1f1}
          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
      husStderr:
        preprocessor: pp500
        reference_dataset: AIRS
        mip: Amon
        frequency: mon
        start_year: 2003
        end_year: 2010
        additional_datasets:
          - {dataset: AIRS, project: obs4mips, level: L3, version: RetStd-v5, tier: 1}
    scripts:
      ecs_scatter:
        diag: humidx
        calcmm: True
        ecs_file: $diag_scripts/emergent_constraints/ecs_cmip.nc
        legend_outside: False
        predef_minmax: True
        script: emergent_constraints/ecs_scatter.ncl

  ltmi:
    description: lower tropospheric mixing index
    themes:
      - EC
    realms:
      - atmos
    variables:
      hur:
        preprocessor: pp_ltmi_1
        reference_dataset: ERA-Interim
        start_year: 1980
        end_year: 2005
        exp: historical
        mip: Amon
        project: CMIP6
      ta:
        preprocessor: pp_ltmi_1
        reference_dataset: ERA-Interim
        start_year: 1980
        end_year: 2005
        exp: historical
        mip: Amon
        project: CMIP6
      wap:
        preprocessor: pp_ltmi_0
        reference_dataset: ERA-Interim
        start_year: 1980
        end_year: 2005
        exp: historical
        mip: Amon
        project: CMIP6
    additional_datasets:
      - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#      - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#      - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#      - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r19i1p1f1}
#      - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
      - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1,tier: 3}
    scripts:
      ecs_scatter:
        diag: ltmi
        calcmm: True
        ecs_file: $diag_scripts/emergent_constraints/ecs_cmip.nc
        legend_outside: False
        predef_minmax: True
        script: emergent_constraints/ecs_scatter.ncl

  shhc:
    description: climatological Hadley cell extent
    themes:
      - EC
    realms:
      - atmos
    variables:
      va:
        reference_dataset: ERA-Interim
        start_year: 1980
        end_year: 2005
        exp: historical
        mip: Amon
        project: CMIP6
    additional_datasets:
      - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
      - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r4i1p1f1}
#      - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#      - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#      - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
      - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3}
    scripts:
      ecs_scatter:
        diag: shhc
        calcmm: True
        ecs_file: $diag_scripts/emergent_constraints/ecs_cmip.nc
        legend_outside: False
        predef_minmax: True
        script: emergent_constraints/ecs_scatter.ncl

  covrefl:
    description: covariance of shortwave cloud reflection
    themes:
      - EC
    realms:
      - atmos
    variables:
      ts:
        reference_dataset: HadISST
        start_year: 2001
        end_year: 2012
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: HadISST, project: OBS, type: reanaly, version: 1, tier: 2}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r9i1p1f1}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
      hur:
        preprocessor: pp500
        reference_dataset: ERA-Interim
        start_year: 2001
        end_year: 2012
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: ERA-Interim, project: OBS, type: reanaly, version: 1, tier: 3}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r9i1p1f1}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
      rsut:
        reference_dataset: CERES-EBAF
        start_year: 2001
        end_year: 2012
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: CERES-EBAF, project: obs4mips, level: L3B, version: Ed2-7, tier: 1}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r9i1p1f1}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
      rsutcs:
        reference_dataset: CERES-EBAF
        start_year: 2001
        end_year: 2012
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: CERES-EBAF, project: obs4mips, level: L3B, version: Ed2-7, tier: 1}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r9i1p1f1}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
      rsdt:
        reference_dataset: CERES-EBAF
        start_year: 2001
        end_year: 2012
        exp: historical
        mip: Amon
        project: CMIP6
        additional_datasets:
          - {dataset: CERES-EBAF, project: obs4mips, level: L3B, version: Ed2-7, tier: 1}
          - {dataset: GISS-E2-1-G, grid: gn, ensemble: r1i1p1f1}
#          - {dataset: IPSL-CM6A-LR, grid: gr, ensemble: r9i1p1f1}
#          - {dataset: CNRM-CM6-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: CNRM-ESM2-1, grid: gr, ensemble: r1i1p1f2}
#          - {dataset: MIROC6, grid: gn, ensemble: r1i1p1f1}
    scripts:
      ecs_scatter:
        diag: covrefl
        calcmm: True
        ecs_file: $diag_scripts/emergent_constraints/ecs_cmip.nc
        legend_outside: False
        predef_minmax: True
        script: emergent_constraints/ecs_scatter.ncl
